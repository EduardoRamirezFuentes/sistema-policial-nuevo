<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestión Policial</title>
    <!-- Cargar estilos primero -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="./css/style.css" rel="stylesheet">
    <script>
        // Mostrar el formulario de login y ocultar el dashboard inmediatamente
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM cargado, configurando visibilidad inicial...');
            
            // Ocultar dashboard
            const dashboard = document.getElementById('dashboard');
            if (dashboard) {
                console.log('Ocultando dashboard...');
                dashboard.style.display = 'none';
                dashboard.style.visibility = 'hidden';
                dashboard.style.opacity = '0';
                dashboard.style.position = 'absolute';
                dashboard.style.height = '0';
                dashboard.style.overflow = 'hidden';
                dashboard.style.width = '0';
            }
            
            // Mostrar formulario de login
            const loginContainer = document.getElementById('loginContainer');
            if (loginContainer) {
                console.log('Mostrando formulario de login...');
                loginContainer.style.display = 'flex';
                loginContainer.style.visibility = 'visible';
                loginContainer.style.opacity = '1';
                loginContainer.style.position = 'relative';
                loginContainer.style.height = '100vh';
                loginContainer.style.width = '100%';
                loginContainer.style.alignItems = 'center';
                loginContainer.style.justifyContent = 'center';
                loginContainer.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
                
                // Limpiar cualquier estado de inicio de sesión previo
                localStorage.removeItem('isLoggedIn');
                console.log('Estado de inicio de sesión restablecido');
            }
        });
    </script>
    <!-- Cargar scripts al final -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="./js/app.js" defer></script>
</head>
<body class="login-page" style="background: url('/img/ssc.png') no-repeat center center fixed; background-size: cover; background-color: #720F36;">
    <!-- Fondo con elementos decorativos -->
    <div class="bg-elements">
        <div class="circle circle-1"></div>
        <div class="circle circle-2"></div>
        <div class="circle circle-3"></div>
    </div>

    <!-- Contenedor de login - Visible por defecto -->
    <div class="login-container fade-in" id="loginContainer" style="display: flex; visibility: visible; opacity: 1; position: relative; z-index: 1000; height: 100vh; width: 100%; align-items: center; justify-content: center; background: rgba(0, 0, 0, 0.7);">
        <div class="login-box">
            <div class="login-header mb-4">
                <div class="logo-container">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <h2>SSC TIZAYUCA</h2>
                <p class="text-muted">Inicia sesión para continuar</p>
            </div>
            
            <form id="loginForm" class="mt-4">
                <div class="form-group mb-3">
                    <label for="username" class="form-label">Usuario</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-user"></i></span>
                        <input type="text" class="form-control" id="username" name="username" placeholder="Ingresa tu usuario" required autocomplete="username">
                    </div>
                </div>
                
                <div class="form-group mb-4">
                    <label for="password" class="form-label">Contraseña</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-lock"></i></span>
                        <input type="password" class="form-control" id="password" name="password" placeholder="••••••••" required autocomplete="current-password">
                    </div>
                </div>
                
                <div id="loginError" class="alert alert-danger mb-3 d-none" role="alert"></div>
                
                <button type="submit" class="btn btn-primary w-100 py-2">
                    <span class="me-2">Ingresar</span>
                    <i class="fas fa-arrow-right"></i>
                </button>
            </form>
            
            <div class="login-footer mt-4 text-center">
                <p class="text-muted small">Sistema de Gestión Policial v1.0</p>
            </div>
        </div>
    </div>

    <!-- Contenido principal - Oculto por defecto -->
    <div id="dashboard" style="display: none !important; visibility: hidden !important; opacity: 0 !important; position: absolute !important; height: 0 !important; overflow: hidden !important; width: 0 !important; padding: 0 !important; margin: 0 !important;">
        <!-- Barra de navegación -->
        <nav class="navbar navbar-expand-lg navbar-dark">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <i class="fas fa-shield-alt me-2"></i>
                    <span>Sistema Policial</span>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" data-page="datos-generales">
                                <i class="fas fa-user-tie me-1"></i> Datos Generales
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-page="evaluaciones">
                                <i class="fas fa-clipboard-check me-1"></i> Evaluaciones
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-page="formacion">
                                <i class="fas fa-graduation-cap me-1"></i> Formación
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-page="estatus-poli">
                                <i class="fas fa-search me-1"></i> Estatus Poli
                            </a>
                        </li>
                    </ul>
                    <div class="d-flex align-items-center">
                        <div class="user-info me-3">
                            <div class="user-name">Administrador</div>
                            <div class="user-role small">Administrador del Sistema</div>
                        </div>
                        <button id="logoutBtn" class="btn btn-logout">
                            <i class="fas fa-sign-out-alt me-1"></i> Cerrar Sesión
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <div class="container mt-4">
            <div id="datos-generales" class="page-content">
                <h2>Datos Generales del Policía</h2>
                <form id="policiaForm">
                    <div class="row">
                        <!-- Columna Izquierda -->
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="nombreCompleto" class="form-label">Nombre Completo</label>
                                <input type="text" class="form-control" id="nombreCompleto" name="nombreCompleto" required>
                            </div>
                            <div class="mb-3">
                                <label for="curp" class="form-label">CURP (18 caracteres)</label>
                                <input type="text" class="form-control" id="curp" name="curp" maxlength="18" required>
                                <div class="form-text">Ingrese los 18 caracteres de la CURP</div>
                            </div>
                            <div class="mb-3">
                                <label for="cuip" class="form-label">CUIP</label>
                                <input type="text" class="form-control" id="cuip" name="cuip" required>
                            </div>
                            <div class="mb-3">
                                <label for="cup" class="form-label">CUP</label>
                                <input type="text" class="form-control" id="cup" name="cup" required>
                            </div>
                            <div class="mb-3">
                                <label for="edad" class="form-label">Edad</label>
                                <input type="number" class="form-control" id="edad" name="edad" min="18" max="100" required>
                            </div>
                            <div class="mb-3">
                                <label for="sexo" class="form-label">Sexo</label>
                                <select class="form-select" id="sexo" name="sexo" required>
                                    <option value="">Seleccione una opción</option>
                                    <option value="Masculino">Masculino</option>
                                    <option value="Femenino">Femenino</option>
                                    <option value="Otro">Otro</option>
                                </select>
                            </div>
                        </div>

                        <!-- Columna Derecha -->
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="estadoCivil" class="form-label">Estado Civil</label>
                                <select class="form-select" id="estadoCivil" name="estadoCivil" required>
                                    <option value="">Seleccione una opción</option>
                                    <option value="Soltero/a">Soltero/a</option>
                                    <option value="Casado/a">Casado/a</option>
                                    <option value="Divorciado/a">Divorciado/a</option>
                                    <option value="Viudo/a">Viudo/a</option>
                                    <option value="Unión Libre">Unión Libre</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="areaAdscripcion" class="form-label">Área de Adscripción</label>
                                <input type="text" class="form-control" id="areaAdscripcion" name="areaAdscripcion" required>
                            </div>
                            <div class="mb-3">
                                <label for="grado" class="form-label">Grado</label>
                                <input type="text" class="form-control" id="grado" name="grado" required>
                            </div>
                            <div class="mb-3">
                                <label for="cargoActual" class="form-label">Cargo Actual</label>
                                <input type="text" class="form-control" id="cargoActual" name="cargoActual" required>
                            </div>
                            <div class="mb-3">
                                <label for="fechaIngreso" class="form-label">Fecha de Ingreso</label>
                                <input type="date" class="form-control" id="fechaIngreso" name="fechaIngreso" required>
                                <div class="form-text">Formato: AAAA-MM-DD</div>
                            </div>
                            <div class="mb-3">
                                <label for="escolaridad" class="form-label">Escolaridad</label>
                                <select class="form-select" id="escolaridad" name="escolaridad" required>
                                    <option value="">Seleccione una opción</option>
                                    <option value="Primaria">Primaria</option>
                                    <option value="Secundaria">Secundaria</option>
                                    <option value="Preparatoria">Preparatoria</option>
                                    <option value="Técnico Superior">Técnico Superior</option>
                                    <option value="Licenciatura">Licenciatura</option>
                                    <option value="Maestría">Maestría</option>
                                    <option value="Doctorado">Doctorado</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Segunda Fila -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="telefonoContacto" class="form-label">Teléfono de Contacto</label>
                                <input type="tel" class="form-control" id="telefonoContacto" name="telefonoContacto" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="telefonoEmergencia" class="form-label">Teléfono de Emergencia</label>
                                <input type="tel" class="form-control" id="telefonoEmergencia" name="telefonoEmergencia" required>
                            </div>
                        </div>
                    </div>

                    <!-- Tercera Fila -->
                    <div class="row">
                        <div class="col-12">
                            <div class="mb-3">
                                <label for="funcion" class="form-label">Función</label>
                                <textarea class="form-control" id="funcion" name="funcion" rows="3" required></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Cuarta Fila -->
                    <div class="row">
                        <div class="col-12">
                            <div class="mb-3">
                                <label for="pdfFile" class="form-label">Documento PDF (Opcional)</label>
                                <input type="file" class="form-control" id="pdfFile" name="pdfFile" accept=".pdf">
                                <div class="form-text">Tamaño máximo: 10MB</div>
                            </div>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Guardar</button>
                </form>

                <hr class="my-5">
                
                <div class="search-section">
                    <h3>Buscar Policía</h3>
                    <div class="input-group mb-3">
                        <input type="text" id="searchInput" class="form-control" placeholder="Buscar por nombre...">
                        <button class="btn btn-outline-secondary" type="button" id="searchBtn">Buscar</button>
                    </div>
                    <div id="searchResults"></div>
                </div>
            </div>

            <div id="evaluaciones" class="page-content d-none">
                <div class="glass-card mb-4">
                    <h2 class="mb-4"><i class="fas fa-clipboard-check me-2"></i>Registro de Evaluaciones</h2>
                    
                    <form id="evaluacionForm">
                        <div class="row">
                            <!-- Búsqueda de Oficial -->
                            <div class="col-md-6 mb-3">
                                <label for="buscarOficial" class="form-label">Buscar Oficial</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="buscarOficial" placeholder="Ingrese nombre del oficial" required>
                                    <button class="btn btn-primary" type="button" id="btnBuscarOficial">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                                <div id="resultadosBusqueda" class="mt-2"></div>
                                <input type="hidden" id="id_oficial" name="id_oficial" required>
                            </div>

                            <!-- Datos del Oficial (solo lectura) -->
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Oficial Seleccionado</label>
                                <div class="card bg-light p-3" id="infoOficial">
                                    <p class="mb-1 text-muted">Ningún oficial seleccionado</p>
                                    <small class="text-muted">Busque y seleccione un oficial de la lista</small>
                                </div>
                            </div>

                            <!-- Datos de la Evaluación -->
                            <div class="col-md-6 mb-3">
                                <label for="tipo_evaluacion" class="form-label">Tipo de Evaluación</label>
                                <select class="form-select" id="tipo_evaluacion" name="tipo_evaluacion" required>
                                    <option value="">Seleccione un tipo</option>
                                    <option value="Evaluación de Desempeño">Evaluación de Desempeño</option>
                                    <option value="Evaluación de Conocimientos">Evaluación de Conocimientos</option>
                                    <option value="Evaluación Física">Evaluación Física</option>
                                    <option value="Evaluación Psicológica">Evaluación Psicológica</option>
                                    <option value="Otra">Otra</option>
                                </select>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="fecha_evaluacion" class="form-label">Fecha de Evaluación</label>
                                <input type="date" class="form-control" id="fecha_evaluacion" name="fecha_evaluacion" required>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="calificacion" class="form-label">Calificación (0-100)</label>
                                <input type="number" class="form-control" id="calificacion" name="calificacion" 
                                       min="0" max="100" step="0.01" required>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="evaluador" class="form-label">Evaluador</label>
                                <input type="text" class="form-control" id="evaluador" name="evaluador" required>
                            </div>

                            <div class="col-12 mb-3">
                                <label for="observaciones" class="form-label">Observaciones</label>
                                <textarea class="form-control" id="observaciones" name="observaciones" rows="3"></textarea>
                            </div>

                            <div class="col-12 text-end">
                                <button type="button" class="btn btn-secondary me-2" id="btnLimpiar">
                                    <i class="fas fa-eraser me-1"></i> Limpiar
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-1"></i> Guardar Evaluación
                                </button>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Listado de Evaluaciones -->
                <div class="glass-card">
                    <h3 class="mb-4"><i class="fas fa-list me-2"></i>Historial de Evaluaciones</h3>
                    <div class="table-responsive">
                        <table class="table table-hover" id="tablaEvaluaciones">
                            <thead>
                                <tr>
                                    <th>Oficial</th>
                                    <th>Tipo</th>
                                    <th>Fecha</th>
                                    <th>Calificación</th>
                                    <th>Evaluador</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="cuerpoTablaEvaluaciones">
                                <!-- Los datos se cargarán dinámicamente -->
                                <tr>
                                    <td colspan="6" class="text-center">No hay evaluaciones registradas</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Pestaña de Formación -->
            <div id="formacion" class="page-content d-none">
                <div class="glass-card mb-4">
                    <h2 class="mb-4"><i class="fas fa-graduation-cap me-2"></i>Registro de Formación</h2>
                    
                    <form id="formacionForm">
                        <input type="hidden" id="formacion_id" name="id">
                        
                        <!-- Buscador de oficiales para Formación -->
                        <div class="row mb-4">
                            <div class="col-md-8">
                                <label for="buscarOficialFormacion" class="form-label">Buscar Oficial</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="buscarOficialFormacion" placeholder="Ingrese nombre o número de placa">
                                    <button class="btn btn-outline-secondary" type="button" id="btnBuscarOficialFormacion">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                                <div id="resultadosBusquedaFormacion" class="mt-2 d-none" style="position: absolute; z-index: 1000; width: 100%; max-width: 800px;">
                                    <div class="list-group" id="listaOficialesFormacion"></div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Oficial seleccionado</label>
                                <div id="oficialSeleccionadoFormacion" class="form-control bg-light">
                                    Ningún oficial seleccionado
                                </div>
                                <input type="hidden" id="id_oficial_formacion" name="id_oficial">
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="curso" class="form-label">Curso</label>
                                <input type="text" class="form-control" id="curso" name="curso" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="tipo_curso" class="form-label">Tipo</label>
                                <select class="form-select" id="tipo_curso" name="tipo_curso" required>
                                    <option value="">Seleccione un tipo</option>
                                    <option value="Diplomado">Diplomado</option>
                                    <option value="Curso">Curso</option>
                                    <option value="Taller">Taller</option>
                                    <option value="Seminario">Seminario</option>
                                    <option value="Otro">Otro</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="institucion" class="form-label">Institución</label>
                                <input type="text" class="form-control" id="institucion" name="institucion" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="fecha_curso" class="form-label">Fecha</label>
                                <input type="date" class="form-control" id="fecha_curso" name="fecha_curso" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="resultado_curso" class="form-label">Resultado</label>
                                <input type="text" class="form-control" id="resultado_curso" name="resultado_curso" required>
                            </div>
                        </div>
                        
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end mb-4">
                            <button type="button" class="btn btn-secondary me-md-2" id="btnLimpiarFormacion">
                                <i class="fas fa-eraser me-1"></i> Limpiar
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-1"></i> Guardar Formación
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Subformulario de Competencias Básicas -->
                <div class="glass-card">
                    <h3 class="mb-4"><i class="fas fa-tasks me-2"></i>Competencias Básicas</h3>
                    
                    <form id="competenciasForm">
                        <input type="hidden" id="competencia_id" name="id">
                        
                        <!-- Buscador de oficiales para Competencias Básicas -->
                        <div class="row mb-4">
                            <div class="col-md-8">
                                <label for="buscarOficialCompetencia" class="form-label">Buscar Oficial</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="buscarOficialCompetencia" placeholder="Ingrese nombre o número de placa">
                                    <button class="btn btn-outline-secondary" type="button" id="btnBuscarOficialCompetencia">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                                <div id="resultadosBusquedaCompetencia" class="mt-2 d-none" style="position: absolute; z-index: 1000; width: 100%; max-width: 800px;">
                                    <div class="list-group" id="listaOficialesCompetencia"></div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Oficial seleccionado</label>
                                <div id="oficialSeleccionadoCompetencia" class="form-control bg-light">
                                    Ningún oficial seleccionado
                                </div>
                                <input type="hidden" id="id_oficial_competencia" name="id_oficial">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label for="fecha_competencia" class="form-label">Fecha</label>
                                <input type="date" class="form-control" id="fecha_competencia" name="fecha_competencia" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="institucion_competencia" class="form-label">Institución</label>
                                <input type="text" class="form-control" id="institucion_competencia" name="institucion_competencia" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="resultado_competencia" class="form-label">Resultado</label>
                                <input type="text" class="form-control" id="resultado_competencia" name="resultado_competencia" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label for="vigencia" class="form-label">Vigencia</label>
                                <input type="date" class="form-control" id="vigencia" name="vigencia" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="enlace_constancia" class="form-label">Enlace a Constancia Digital</label>
                                <input type="url" class="form-control" id="enlace_constancia" name="enlace_constancia">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="archivo_pdf" class="form-label">PDF de Constancia (Opcional)</label>
                                <input type="file" class="form-control" id="archivo_pdf" name="archivo_pdf" accept=".pdf">
                            </div>
                        </div>
                        
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <button type="button" class="btn btn-secondary me-md-2" id="btnLimpiarCompetencia">
                                <i class="fas fa-eraser me-1"></i> Limpiar
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-1"></i> Guardar Competencia
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Tabla de registros de formación -->
                <div class="glass-card mt-4">
                    <h3 class="mb-4"><i class="fas fa-list me-2"></i>Historial de Formación</h3>
                    <div class="table-responsive">
                        <table class="table table-hover" id="tablaFormacion">
                            <thead>
                                <tr>
                                    <th>Curso</th>
                                    <th>Tipo</th>
                                    <th>Institución</th>
                                    <th>Fecha</th>
                                    <th>Resultado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="cuerpoTablaFormacion">
                                <tr>
                                    <td colspan="6" class="text-center">No hay registros de formación</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Pestaña de Estatus Poli -->
            <div id="estatus-poli" class="page-content d-none">
                <div class="glass-card mb-4">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2 class="mb-0"><i class="fas fa-users me-2"></i>Numero del Personal Policial</h2>
                        <button id="btnActualizarEstadisticas" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-sync-alt me-1"></i> Cargar Estadisticas de Polis
                        </button>
                    </div>
                    
                    <!-- Contenedor del mensaje de carga -->
                    <div id="chartLoading" class="text-center py-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Cargando...</span>
                        </div>
                        <p class="mt-2 mb-0">Cargando estadísticas de oficiales...</p>
                    </div>
                    
                    <!-- Contenedor del mensaje de error -->
                    <div id="chartError" class="alert alert-danger d-none" role="alert">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <span id="errorMessage">Error al cargar los datos. Intente nuevamente.</span>
                    </div>
                    
                    <!-- Contenedor de los contadores -->
                    <div id="estadoOficialesContadores" class="d-none">
                        <div class="row text-center">
                            <div class="col-md-6 mb-3 mb-md-0">
                                <div class="card bg-success bg-opacity-25 border-success border-2 h-100">
                                    <div class="card-body">
                                        <h2 class="display-4 fw-bold text-white mb-0" id="contadorActivos">0</h2>
                                        <p class="text-white-75 mb-0">Oficiales Activos</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card bg-danger bg-opacity-25 border-danger border-2 h-100">
                                    <div class="card-body">
                                        <h2 class="display-4 fw-bold text-white mb-0" id="contadorInactivos">0</h2>
                                        <p class="text-white-75 mb-0">Oficiales Inactivos</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="text-muted small text-end mt-2">
                            <i class="far fa-clock me-1"></i>
                            Última Modificacion papi: <span id="fechaActualizacion">--/--/---- --:--:--</span>
                        </div>
                    </div>
                </div>
                
                <!-- Sección de búsqueda -->
                <div class="glass-card">
                    <h2 class="mb-4"><i class="fas fa-search me-2"></i>Búsqueda de Personal Policial</h2>
                    
                    <div class="row mb-4">
                        <div class="col-md-8">
                            <form id="formBusquedaOficial" onsubmit="event.preventDefault(); document.getElementById('btnBuscarOficialEstatus').click();">
                                <div class="input-group">
                                    <input type="text" class="form-control" id="buscarOficialEstatus" 
                                           placeholder="Buscar por nombre completo, CURP, CUIP o CUP..."
                                           autocomplete="off" autofocus>
                                    <button class="btn btn-primary" type="button" id="btnBuscarOficialEstatus">
                                        <i class="fas fa-search me-1"></i> Buscar
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                
                <div class="text-end mt-3">
                    <small class="text-muted">Actualizado: <span id="fechaActualizacion">-</span></small>
                </div>

                    <div id="resultadoBusqueda" class="mt-4">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h4>Resultados de la búsqueda</h4>
                            <button id="generarPDF" class="btn" style="background-color: #720F36; color: white;">
                                <i class="fas fa-file-pdf me-1"></i> Generar PDF
                            </button>
                        </div>
                        
                        <div class="row g-4" id="contenedorTarjetas">
                            <!-- Las tarjetas se cargarán aquí dinámicamente -->
                        </div>
                        
                        <!-- Contenedor oculto para la tabla (se usa para generar el PDF) -->
                        <div class="d-none">
                            <table class="table" id="tablaResultados">
                                <thead>
                                    <tr>
                                        <th>Nombre Completo</th>
                                        <th>CURP</th>
                                        <th>CUIP</th>
                                        <th>CUP</th>
                                        <th>Edad</th>
                                        <th>Sexo</th>
                                        <th>Estado Civil</th>
                                        <th>Área de Adscripción</th>
                                        <th>Grado</th>
                                        <th>Cargo Actual</th>
                                        <th>Fecha de Ingreso</th>
                                        <th>Teléfono de Contacto</th>
                                        <th>Teléfono de Emergencia</th>
                                        <th>Función</th>
                                    </tr>
                                </thead>
                                <tbody id="cuerpoTabla">
                                    <!-- Los resulta    dos se cargarán aquí dinámicamente para el PDF -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jsPDF library for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- Nuestra aplicación JavaScript -->
    <script>
        // Función para verificar si un elemento existe
        function elementExists(selector) {
            const el = document.querySelector(selector);
            console.log('Elemento ' + selector + ':', el ? 'Encontrado' : 'No encontrado');
            return el !== null;
        }
        
        // Inicialización cuando el DOM esté completamente cargado
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM completamente cargado');
            
            // Función para cargar las estadísticas de oficiales
            function cargarEstadisticas() {
                console.log('Iniciando carga de estadísticas...');
                if (typeof cargarGraficaEstadoOficiales === 'function') {
                    cargarGraficaEstadoOficiales();
                } else {
                    console.error('Error: La función cargarGraficaEstadoOficiales no está definida');
                    const errorElement = document.getElementById('chartError');
                    if (errorElement) {
                        errorElement.innerHTML = `
                            <div class="d-flex align-items-center">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                <div>
                                    <div class="fw-bold">Error de inicialización</div>
                                    <div class="small">No se pudo cargar la función de estadísticas</div>
                                    <button class="btn btn-sm btn-outline-danger mt-2" onclick="location.reload()">
                                        <i class="fas fa-sync-alt me-1"></i> Recargar página
                                    </button>
                                </div>
                            </div>
                        `;
                        errorElement.classList.remove('d-none');
                        
                        const loadingElement = document.getElementById('chartLoading');
                        if (loadingElement) loadingElement.classList.add('d-none');
                    }
                }
            }
            
            // 1. Configurar el manejador de eventos para el botón de actualización
            const btnActualizar = document.getElementById('btnActualizarEstadisticas');
            if (btnActualizar) {
                btnActualizar.addEventListener('click', cargarEstadisticas);
                console.log('Manejador de eventos agregado al botón de actualización');
            } else {
                console.error('No se encontró el botón de actualización');
            }
            
            // 2. Cargar estadísticas cuando se muestre la pestaña Estatus Poli
            const estatusPoliTab = document.querySelector('a[href="#estatus-poli"]');
            if (estatusPoliTab) {
                console.log('Pestaña Estatus Poli encontrada, configurando manejadores...');
                
                // Configurar el manejador de eventos para cuando se muestre la pestaña
                estatusPoliTab.addEventListener('shown.bs.tab', function(e) {
                    console.log('Pestaña Estatus Poli mostrada, cargando estadísticas...');
                    cargarEstadisticas();
                    
                    // Forzar el enfoque en el campo de búsqueda
                    const buscarInput = document.getElementById('buscarOficialEstatus');
                    if (buscarInput) {
                        setTimeout(() => {
                            buscarInput.focus();
                        }, 100);
                    }
                });
                
                // Si ya estamos en la pestaña Estatus Poli al cargar la página
                if (window.location.hash === '#estatus-poli') {
                    console.log('Ya estamos en la pestaña Estatus Poli, cargando estadísticas...');
                    // Mostrar la pestaña activa
                    const tab = new bootstrap.Tab(estatusPoliTab);
                    tab.show();
                    
                    // Cargar estadísticas después de un pequeño retraso
                    setTimeout(cargarEstadisticas, 100);
                }
            } else {
                console.error('No se encontró la pestaña Estatus Poli');
            }
            
            // 3. Verificar que los elementos clave existan
            console.log('Verificando elementos del DOM...');
            elementExists('#estadoOficialesContadores');
            elementExists('#contadorActivos');
            elementExists('#contadorInactivos');
            elementExists('#fechaActualizacion');
            elementExists('#chartLoading');
            elementExists('#chartError');
            
            console.log('Inicialización completada');
            if (testBtn) {
                testBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Botón de prueba clickeado');
                    if (typeof cargarGraficaEstadoOficiales === 'function') {
                        console.log('Llamando a cargarGraficaEstadoOficiales...');
                        cargarGraficaEstadoOficiales();
                    } else {
                        console.error('Error: La función cargarGraficaEstadoOficiales no está definida');
                    }
                });
                console.log('Manejador de eventos del botón de prueba asignado');
            }
        });
    </script>
    
    <!-- Cargar app.js -->
    <script src="../js/app.js"></script>
    <!-- Cargar complementos de PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script>
        // Make jsPDF available globally
        window.jsPDF = window.jspdf.jsPDF;
    </script>
    <!-- Imagen de fondo de prueba -->
    <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1000; background: url('/img/ssc.png') no-repeat center center; background-size: cover; opacity: 0.5;"></div>
</body>
</html>
